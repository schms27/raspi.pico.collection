import time
import random
from machine import Pin, PWM
from buzzer_music import music

# Construct PWM object for motors on pins 10, 12 & 14
lid = PWM(Pin(10))
flag = PWM(Pin(12))
arm = PWM(Pin(14))

# Create Switch
switch = machine.Pin(27, machine.Pin.IN, machine.Pin.PULL_DOWN)

# Set the PWM frequency
lid.freq(50)
flag.freq(50)
arm.freq(50)

speeds = [10, 25, 50, 80, 150, 200]
arm_positions = {0:8400, 5:6500, 6:5000, 8:4500, 10:2690}
lid_positions = {0:2200, 5:3600, 6:3800, 8:3930, 9:4500, 10:6200}
flag_positions = {0:7500, 5:6500, 8:4500, 10:2400}

MAX_NORMAL_TRIES = 6

shortSongs = {
    "failJingle": music('6 G#4 1 17;0 G5 1 17;4 A4 1 17;10 G#4 1 17;12 G#4 1 17;2 D#5 1 17;14 G#4 1 17;18 E3 1 17;20 F3 1 17;10 F#4 1 17;14 F#4 1 17;18 D3 1 17;20 D#3 1 17;4 G4 1 17;0 F5 1 17', pins=[Pin(21)], looping=False),
    "mario": music('0 A5 3 21;4 F5 3 21;7 C5 1 21;8 D5 1 21;9 F5 1 21;11 F5 3 21;15 D5 1 21;16 C5 1 21;18 F5 1 21;20 F5 1 21;22 C6 1 21;24 A5 3 21;27 G5 3 21;30 C5 1 21', pins=[Pin(21)], looping=False),
    "mesto": music('0 G#6 6 43;11 G#5 5 43;0 D#2 1 36;4 D#2 1 36;8 D#2 1 36;12 D#2 1 36;4 G2 1 36;12 G2 1 36;16 D#2 1 36;20 D#2 1 36;24 D#2 1 36;28 D#2 1 36;20 G2 1 36;28 G2 1 36;8 D#6 3 43;6 E6 2 43;16 G#5 2 43;18 G#6 2 43;20 G#5 2 43;22 G#6 2 43;24 G#5 2 43;27 G#6 2 43;0 G#3 6 43;11 G#2 5 43;8 D#3 3 43;6 E3 2 43;16 G#2 2 43;20 G#2 2 43;24 G#2 2 43;18 G#4 2 43;22 G#4 2 43;27 G#3 3 43;18 G#2 2 43;16 G#4 2 43;20 G#4 2 43;22 G#2 2 43;24 G#4 2 43', pins=[Pin(21)], looping=False),
    "polka": music('0 F#3 1 4;4 C#3 1 4;8 F#3 1 4;12 C#3 1 4;14 E3 1 4;16 F#3 1 4;20 C#3 1 4;24 F#3 1 4;28 C#3 1 4;32 F#3 1 4;36 C#3 1 4;30 E3 1 4;40 F#3 1 4;44 C3 1 4;48 F#3 1 4;46 E3 1 4;52 C3 1 4;56 F#3 1 4;63 F#3 1 4;67 C3 1 4;71 F#3 1 4;75 C3 1 4;79 C3 1 4;77 E3 1 4;64 C#5 1 4;62 F#5 1 4;66 F#5 1 4;70 G#5 1 4;72 A5 1 4;71 A5 1 4;76 F#5 1 4;74 F#5 1 4;78 F#5 1 4;68 F#5 1 4;75 F#5 1 4;80 A5 1 4;81 G#5 1 4;83 E5 1 4;85 E5 1 4;87 G#5 1 4;88 A5 1 4;90 F#5 1 4;92 F#5 1 4;95 F#5 1 4;94 F#5 1 4;97 C#5 1 4;99 F#5 1 4;101 F#5 1 4;104 G#5 1 4;105 A5 1 4;107 F#5 1 4;108 F#5 1 4;110 F#5 1 4;111 F#5 1 4;112 A5 1 4;114 C#6 1 4;115 C#6 1 4;116 C#6 1 4;119 A5 1 4;118 B5 1 4;121 G#5 1 4;123 A5 1 4;125 F#5 1 4;127 F#5 1 4;129 F#5 1 4;130 F#5 1 4;131 C#6 1 4;133 C#6 1 4;134 B5 1 4;136 A5 1 4;138 G#5 1 4;140 E5 1 4;141 E5 1 4;143 E5 1 4;144 E5 1 4;146 G#5 1 4;147 B5 1 4;148 B5 1 4;149 B5 1 4;150 B5 1 4;151 A5 1 4;152 A5 1 4;153 G#5 1 4;154 G#5 1 4;154 G#5 1 4;155 A5 1 4;157 F#5 1 4;158 F#5 1 4;155 A5 1 4', pins=[Pin(21)], looping=False),
    "pacman": music('0 C#5 1 14;1 C#6 1 14;2 G#5 1 14;3 C#5 1 14;4 C#6 1 14;5 G#5 1 14;6 C#5 1 14;8 D5 1 14;9 D6 1 14;10 A5 1 14;11 D5 1 14;12 D6 1 14;13 A5 1 14;14 D5 1 14;16 C#5 1 14;17 C#6 1 14;18 G#5 1 14;19 C#5 1 14;20 C#6 1 14;21 G#5 1 14;22 C#5 1 14;24 F5 1 14;25 F#5 1 14;26 G#5 1 14;27 A5 1 14;28 B5 1 14;29 C6 1 14;30 C#6 1 14;0 C#3 3 15;3 G#3 1 15;4 F3 2 15;6 G#3 2 15;8 D3 3 15;11 A3 1 15;12 F#3 2 15;14 A3 2 15;16 C#3 3 15;19 G#3 1 15;20 F3 2 15;22 G#3 2 15;24 F3 2 15;26 E3 2 15;28 D#3 2 15;30 D3 2 15', pins=[Pin(21)], looping=False),
    "angryBirds": music('0 D4 1 43;1 E4 1 43;2 F4 1 43;3 D4 1 43;4 A4 1 43;5 D4 1 43;6 E4 1 43;7 F4 1 43;8 D4 1 43;10 A4 1 43;12 A4 1 43;13 A#4 1 43;14 A4 1 43;15 G4 1 43;16 F4 1 43;18 F4 1 43;19 E4 1 43;20 D4 1 43;22 D4 1 43;23 E4 1 43;24 F4 1 43;25 D4 1 43;26 F4 1 43;27 G4 1 43;28 A4 1 43;29 F4 1 43;30 A4 1 43;31 B4 1 43;32 C5 1 43;33 B4 1 43;34 C5 1 43;35 B4 1 43;36 A4 1 43;37 D4 1 43', pins=[Pin(21)], looping=False),
    "beeps": music('0 D#6 0.5 14;0.75 D6 0.5 14;2 D6 1 14;3.75 G#6 0.5 14;5.75 F#6 0.75 14;7.5 A#6 0.5 14', pins=[Pin(21)], looping=False)
}


longSongs = {
    "failLong": music('0 D4 1 43;1 D4 1 43;2 D5 1 43;3 C5 1 43;4 D5 1 43;6 D4 1 43;7 E4 1 43;8 F4 1 43;10 D5 1 43;12 G#4 1 43;13 G4 1 43;14 F4 1 43;30 F4 1 43;16 C4 1 43;17 C4 1 43;18 D5 1 43;19 C5 1 43;20 D5 1 43;22 D4 1 43;23 E4 1 43;24 F4 1 43;25 D5 1 43;28 G#4 1 43;29 G4 1 43;26 C5 1 43;27 A4 1 43;46 C4 1 43;32 A3 1 43;33 A3 1 43;34 D5 1 43;35 C5 1 43;36 D5 1 43;38 D4 1 43;39 E4 1 43;40 F4 1 43;42 D5 1 43;44 D4 1 43;45 C#4 1 43;62 D4 1 43;48 C4 1 43;49 C4 1 43;50 D5 1 43;51 C5 1 43;52 D5 1 43;54 D4 1 43;55 E4 1 43;56 F4 1 43;58 D5 1 43;60 C4 1 43;61 C#4 1 43;4 D4 1 43;10 D4 1 43;20 D4 1 43;26 C4 1 43;36 D4 1 43;42 D4 1 43;52 D4 1 43;58 D4 1 43', pins=[Pin(21)], looping=False),
    "neverGonna": music('0 E4 1 8;0 G4 1 8;8 A4 1 8;8 D5 1 8;16 F#4 1 8;16 A4 1 8;24 A4 1 8;24 C#5 1 8;32 E4 1 8;32 G4 1 8;32 B4 1 8;40 A4 1 8;40 D5 1 8;40 F#5 1 8;48 F#4 1 8;48 A4 1 8;48 C#5 1 8;56 A4 1 8;56 C#5 1 8;56 E5 1 8;64 E4 1 8;64 G4 1 8;64 B4 1 8;72 A4 1 8;72 D5 1 8;72 F#5 1 8;80 F#4 1 8;80 A4 1 8;80 C#5 1 8;88 A4 1 8;88 C#5 1 8;88 E5 1 8;96 E4 1 8;96 G4 1 8;96 B4 1 8;100 A5 1 8;102 B5 1 8;104 A4 1 8;104 D5 1 8;104 F#5 1 8;110 D5 1 8;111 E5 1 8;112 F#4 1 8;112 A4 1 8;112 C#5 1 8;118 F#5 1 8;119 A5 1 8;120 A4 1 8;120 C#5 1 8;120 E5 1 8;128 E4 1 8;128 G4 1 8;128 B4 1 8;130 D6 1 8;132 B5 1 8;134 A5 1 8;136 A4 1 8;136 D5 1 8;136 F#5 1 8;142 D5 1 8;143 E5 1 8;144 F#4 1 8;144 A4 1 8;144 C#5 1 8;150 A5 1 8;151 F#5 1 8;152 A4 1 8;152 C#5 1 8;152 E5 1 8;160 E4 1 8;160 G4 1 8;160 B4 1 8;164 A5 1 8;166 B5 1 8;168 D5 1 8;168 F#5 1 8;168 D6 1 8;174 D5 1 8;174 F#6 1 8;175 E5 1 8;175 E6 1 8;176 D5 1 8;176 C#6 1 8;182 F#5 1 8;182 D6 1 8;183 C#6 1 8;184 A4 1 8;184 C#5 1 8;184 E5 1 8;184 A5 1 8;192 E4 1 8;192 G4 1 8;192 B4 1 8;196 B5 1 8;198 A5 1 8;200 A4 1 8;200 D5 1 8;200 F#5 1 8;206 D5 1 8;207 E5 1 8;208 F#4 1 8;208 A4 1 8;208 C#5 1 8;214 F#5 1 8;215 A5 1 8;216 A4 1 8;216 C#5 1 8;216 E5 1 8;224 E4 1 8;224 G4 1 8;224 B4 1 8;228 A5 1 8;230 B5 1 8;232 A4 1 8;232 D5 1 8;232 F#5 1 8;238 D5 1 8;239 E5 1 8;240 F#4 1 8;240 A4 1 8;240 C#5 1 8;244 F#6 1 8;246 F#5 1 8;247 A5 1 8;248 A4 1 8;248 C#5 1 8;248 E5 1 8;256 B4 1 8;256 D5 1 8;256 F#5 1 8;262 B5 1 8;263 A5 1 8;264 G#4 1 8;264 B4 1 8;264 E5 1 8;268 E5 1 8;270 D5 1 8;272 E4 1 8;272 A4 1 8;272 C#5 1 8;278 D5 1 8;279 E5 1 8;280 D4 1 8;280 G4 1 8;280 B4 1 8;288 B4 1 8;288 D5 1 8;288 F#5 1 8;288 D6 1 8;294 B5 1 8;295 A5 1 8;296 G#4 1 8;296 B4 1 8;296 E5 1 8;300 E5 1 8;302 D5 1 8;302 E6 1 8;304 E4 1 8;304 A4 1 8;304 C#5 1 8;304 C#6 1 8;308 D6 1 8;310 F#6 1 8;312 B4 1 8;312 B5 1 8;0 E3 1 8;4 F#3 1 8;8 G3 1 8;12 B3 1 8;16 A3 1 8;20 G3 1 8;24 D3 1 8;32 E3 1 8;36 F#3 1 8;40 G3 1 8;44 B3 1 8;48 A3 1 8;52 G3 1 8;56 D3 1 8;64 E3 1 8;68 F#3 1 8;72 G3 1 8;76 B3 1 8;80 A3 1 8;84 G3 1 8;88 D3 1 8;96 E3 1 8;100 F#3 1 8;104 G3 1 8;108 B3 1 8;112 A3 1 8;116 G3 1 8;120 D3 1 8;128 E3 1 8;132 F#3 1 8;136 G3 1 8;140 B3 1 8;144 A3 1 8;148 G3 1 8;152 D3 1 8;160 E3 1 8;164 F#3 1 8;168 G3 1 8;168 A4 1 8;172 B3 1 8;176 A3 1 8;176 F#4 1 8;176 A4 1 8;180 G3 1 8;184 D3 1 8;192 E3 1 8;196 F#3 1 8;200 G3 1 8;204 B3 1 8;208 A3 1 8;212 G3 1 8;216 D3 1 8;224 E3 1 8;228 F#3 1 8;232 G3 1 8;236 B3 1 8;240 A3 1 8;244 G3 1 8;248 D3 1 8;256 B2 1 8;256 B3 1 8;264 E3 1 8;264 E4 1 8;272 A2 1 8;272 A3 1 8;280 G2 1 8;280 G3 1 8;288 B2 1 8;288 B3 1 8;296 E3 1 8;296 E4 1 8;304 A2 1 8;304 A3 1 8;312 G2 1 8;312 D4 1 8;312 G4 1 8;312 B4 1 8;0 E4 1 26;0 G4 1 26;8 A4 1 26;8 D5 1 26;16 F#4 1 26;16 A4 1 26;24 A4 1 26;24 C#5 1 26;32 E4 1 26;32 G4 1 26;32 B4 1 26;40 A4 1 26;40 D5 1 26;40 F#5 1 26;48 F#4 1 26;48 A4 1 26;48 C#5 1 26;56 A4 1 26;56 C#5 1 26;56 E5 1 26;64 E4 1 26;64 G4 1 26;64 B4 1 26;72 A4 1 26;72 D5 1 26;72 F#5 1 26;80 F#4 1 26;80 A4 1 26;80 C#5 1 26;88 A4 1 26;88 C#5 1 26;88 E5 1 26;96 E4 1 26;96 G4 1 26;96 B4 1 26;100 A5 1 26;102 B5 1 26;104 A4 1 26;104 D5 1 26;104 F#5 1 26;110 D5 1 26;111 E5 1 26;112 F#4 1 26;112 A4 1 26;112 C#5 1 26;118 F#5 1 26;119 A5 1 26;120 A4 1 26;120 C#5 1 26;120 E5 1 26;128 E4 1 26;128 G4 1 26;128 B4 1 26;130 D6 1 26;132 B5 1 26;134 A5 1 26;136 A4 1 26;136 D5 1 26;136 F#5 1 26;142 D5 1 26;143 E5 1 26;144 F#4 1 26;144 A4 1 26;144 C#5 1 26;150 A5 1 26;151 F#5 1 26;152 A4 1 26;152 C#5 1 26;152 E5 1 26;160 E4 1 26;160 G4 1 26;160 B4 1 26;164 A5 1 26;166 B5 1 26;168 D5 1 26;168 F#5 1 26;168 D6 1 26;174 D5 1 26;174 F#6 1 26;175 E5 1 26;175 E6 1 26;176 D5 1 26;176 C#6 1 26;182 F#5 1 26;182 D6 1 26;183 C#6 1 26;184 A4 1 26;184 C#5 1 26;184 E5 1 26;184 A5 1 26;192 E4 1 26;192 G4 1 26;192 B4 1 26;196 B5 1 26;198 A5 1 26;200 A4 1 26;200 D5 1 26;200 F#5 1 26;206 D5 1 26;207 E5 1 26;208 F#4 1 26;208 A4 1 26;208 C#5 1 26;214 F#5 1 26;215 A5 1 26;216 A4 1 26;216 C#5 1 26;216 E5 1 26;224 E4 1 26;224 G4 1 26;224 B4 1 26;228 A5 1 26;230 B5 1 26;232 A4 1 26;232 D5 1 26;232 F#5 1 26;238 D5 1 26;239 E5 1 26;240 F#4 1 26;240 A4 1 26;240 C#5 1 26;244 F#6 1 26;246 F#5 1 26;247 A5 1 26;248 A4 1 26;248 C#5 1 26;248 E5 1 26;256 B4 1 26;256 D5 1 26;256 F#5 1 26;262 B5 1 26;263 A5 1 26;264 G#4 1 26;264 B4 1 26;264 E5 1 26;268 E5 1 26;270 D5 1 26;272 E4 1 26;272 A4 1 26;272 C#5 1 26;278 D5 1 26;279 E5 1 26;280 D4 1 26;280 G4 1 26;280 B4 1 26;288 B4 1 26;288 D5 1 26;288 F#5 1 26;288 D6 1 26;294 B5 1 26;295 A5 1 26;296 G#4 1 26;296 B4 1 26;296 E5 1 26;300 E5 1 26;302 D5 1 26;302 E6 1 26;304 E4 1 26;304 A4 1 26;304 C#5 1 26;304 C#6 1 26;308 D6 1 26;310 F#6 1 26;312 B4 1 26;312 B5 1 26;0 E3 1 26;4 F#3 1 26;8 G3 1 26;12 B3 1 26;16 A3 1 26;20 G3 1 26;24 D3 1 26;32 E3 1 26;36 F#3 1 26;40 G3 1 26;44 B3 1 26;48 A3 1 26;52 G3 1 26;56 D3 1 26;64 E3 1 26;68 F#3 1 26;72 G3 1 26;76 B3 1 26;80 A3 1 26;84 G3 1 26;88 D3 1 26;96 E3 1 26;100 F#3 1 26;104 G3 1 26;108 B3 1 26;112 A3 1 26;116 G3 1 26;120 D3 1 26;128 E3 1 26;132 F#3 1 26;136 G3 1 26;140 B3 1 26;144 A3 1 26;148 G3 1 26;152 D3 1 26;160 E3 1 26;164 F#3 1 26;168 G3 1 26;168 A4 1 26;172 B3 1 26;176 A3 1 26;176 F#4 1 26;176 A4 1 26;180 G3 1 26;184 D3 1 26;192 E3 1 26;196 F#3 1 26;200 G3 1 26;204 B3 1 26;208 A3 1 26;212 G3 1 26;216 D3 1 26;224 E3 1 26;228 F#3 1 26;232 G3 1 26;236 B3 1 26;240 A3 1 26;244 G3 1 26;248 D3 1 26;256 B2 1 26;256 B3 1 26;264 E3 1 26;264 E4 1 26;272 A2 1 26;272 A3 1 26;280 G2 1 26;280 G3 1 26;288 B2 1 26;288 B3 1 26;296 E3 1 26;296 E4 1 26;304 A2 1 26;304 A3 1 26;312 G2 1 26;312 D4 1 26;312 G4 1 26;312 B4 1 26', pins=[Pin(21)], looping=False),
    "stillAlive": music('0 G6 1.9799995422363281 0 0.5118110179901123;2.0699996948242188 F#6 1.9799995422363281 0 0.4881889820098877;4.050000190734863 E6 1.9799995422363281 0 0.4960629940032959;6.020000457763672 E6 1.9799995422363281 0 0.4881889820098877;8.020000457763672 F#6 1.9799995422363281 0 0.5275590419769287;10.129999160766602 D5 1.9799995422363281 0 0.3937007784843445;12.120000839233398 F#5 1.9799995422363281 0 0.4015747904777527;14.09000015258789 D5 1.9799995422363281 0 0.3937007784843445;16.079999923706055 B4 1.9799995422363281 0 0.4173228442668915;18.06999969482422 D5 1.9799995422363281 0 0.3937007784843445;20.049999237060547 F#5 1.9799995422363281 0 0.4015747904777527;22.020000457763672 D5 1.9799995422363281 0 0.3937007784843445;24.020000457763672 A4 1.9799995422363281 0 0.4330708682537079;26.130001068115234 D5 1.9799995422363281 0 0.3937007784843445;28.119998931884766 F#5 1.9799995422363281 0 0.4015747904777527;30.09000015258789 A5 1.9799995422363281 0 0.4881889820098877;30.09000015258789 D5 1.9799995422363281 0 0.3937007784843445;32.08000183105469 G6 1.9799995422363281 0 0.5118110179901123;34.06999969482422 F#6 1.9799995422363281 0 0.4881889820098877;36.04999923706055 E6 1.9799995422363281 0 0.4960629940032959;38.02000045776367 E6 1.9799995422363281 0 0.4881889820098877;40.02000045776367 A4 1.9799995422363281 0 0.4330708682537079;42.130001068115234 F#6 1.9799995422363281 0 0.4881889820098877;44.119998931884766 F#5 1.9799995422363281 0 0.4015747904777527;46.09000015258789 D5 1.9799995422363281 0 0.3937007784843445;48 D6 2 0 0.5118110179901123;50.06999969482422 D5 1.9799995422363281 0 0.3937007784843445;52.04999923706055 E6 1.9799995422363281 0 0.4960629940032959;54.02000045776367 A5 1.9799995422363281 0 0.4881889820098877;56.019996643066406 A4 1.9799995422363281 0 0.4330708682537079;58.12999725341797 D5 1.9799995422363281 0 0.3937007784843445;60.12000274658203 F#5 1.9799995422363281 0 0.4015747904777527;62.089996337890625 D5 1.9799995422363281 0 0.3937007784843445;64.08000183105469 B4 1.9799995422363281 0 0.4173228442668915;66.06999969482422 D5 1.9799995422363281 0 0.3937007784843445;68.05000305175781 F#5 1.9799995422363281 0 0.4015747904777527;70.0199966430664 A5 1.9799995422363281 0 0.4881889820098877;70.0199966430664 D5 1.9799995422363281 0 0.3937007784843445;72 E6 2 0 0.5275590419769287;74 E5 1.9799995422363281 0 0.3937007784843445;76.12000274658203 F#6 1.9799995422363281 0 0.4960629940032959;80.08000183105469 B4 1.9799995422363281 0 0.4173228442668915;78 G6 2 0 0.4881889820098877;82.06999969482422 E5 1.9799995422363281 0 0.3937007784843445;84.05000305175781 E6 1.9799995422363281 0 0.4960629940032959;86 C#6 2 0 0.4881889820098877;88.0199966430664 A4 1.9799995422363281 0 0.4330708682537079;92.12000274658203 G5 1.9799995422363281 0 0.4015747904777527;90 D6 2 0 0.4881889820098877;94.08999633789062 E5 1.9799995422363281 0 0.3937007784843445;96 E6 2 0 0.5118110179901123;98.06999969482422 E5 1.9799995422363281 0 0.3937007784843445;100.05000305175781 A5 1.9799995422363281 0 0.4015747904777527;102 A5 2 0 0.3937007784843445;104.0199966430664 A4 1.9799995422363281 0 0.4330708682537079;106 F#6 2 0 0.4881889820098877;108.12000274658203 F#5 1.9799995422363281 0 0.4015747904777527;110.08999633789062 D5 1.9799995422363281 0 0.3937007784843445;112.08000183105469 B4 1.9799995422363281 0 0.4173228442668915;114.06999969482422 D5 1.9799995422363281 0 0.3937007784843445;116.05000305175781 F#5 1.9799995422363281 0 0.4015747904777527;118.0199966430664 D5 1.9799995422363281 0 0.3937007784843445;120.02000427246094 A4 1.9799995422363281 0 0.4330708682537079;122.1300048828125 D5 1.9799995422363281 0 0.3937007784843445;124.1199951171875 F#5 1.9799995422363281 0 0.4015747904777527;126.08999633789062 D5 1.9799995422363281 0 0.3937007784843445;128.0800018310547 G6 1.9799995422363281 0 0.5118110179901123;130.07000732421875 F#6 1.9799995422363281 0 0.4881889820098877;132.0500030517578 E6 1.9799995422363281 0 0.4960629940032959;134.02000427246094 E6 1.9799995422363281 0 0.4881889820098877;136 F#6 2 0 0.5275590419769287;138.1300048828125 D5 1.9799995422363281 0 0.3937007784843445;140.1199951171875 F#5 1.9799995422363281 0 0.4015747904777527;142.08999633789062 D5 1.9799995422363281 0 0.3937007784843445;144.0800018310547 B4 1.9799995422363281 0 0.4173228442668915;146.07000732421875 D5 1.9799995422363281 0 0.3937007784843445;148.0500030517578 F#5 1.9799995422363281 0 0.4015747904777527;150.02000427246094 D5 1.9799995422363281 0 0.3937007784843445;152.02000427246094 A4 1.9799995422363281 0 0.4330708682537079;154.1300048828125 D5 1.9799995422363281 0 0.3937007784843445;156.1199951171875 F#5 1.9799995422363281 0 0.4015747904777527;158.08999633789062 A5 1.9799995422363281 0 0.4881889820098877;162.07000732421875 F#6 1.9799995422363281 0 0.4881889820098877;164.0500030517578 E6 1.9799995422363281 0 0.4960629940032959;166.02000427246094 E6 1.9799995422363281 0 0.4881889820098877;168.02000427246094 A4 1.9799995422363281 0 0.4330708682537079;170.1300048828125 D5 1.9799995422363281 0 0.3937007784843445;172.1199951171875 F#6 1.9799995422363281 0 0.4960629940032959;174.08999633789062 D6 1.9799995422363281 0 0.4881889820098877;176.0800018310547 B4 1.9799995422363281 0 0.4173228442668915;178.07000732421875 D5 1.9799995422363281 0 0.3937007784843445;180.0500030517578 E6 1.9799995422363281 0 0.4960629940032959;182.02000427246094 A5 1.9799995422363281 0 0.4881889820098877;184.02000427246094 A4 1.9799995422363281 0 0.4330708682537079;186.1300048828125 D5 1.9799995422363281 0 0.3937007784843445;188.1199951171875 F#5 1.9799995422363281 0 0.4015747904777527;190.08999633789062 D5 1.9799995422363281 0 0.3937007784843445;192.0800018310547 B4 1.9799995422363281 0 0.4173228442668915;194.07000732421875 D5 1.9799995422363281 0 0.3937007784843445;196.0500030517578 F#5 1.9799995422363281 0 0.4015747904777527;198.02000427246094 D5 1.9799995422363281 0 0.3937007784843445;200 E6 2 0 0.5275590419769287;202.1300048828125 E5 1.9799995422363281 0 0.3937007784843445;204.1199951171875 F#6 1.9799995422363281 0 0.4960629940032959;208.0800018310547 B4 1.9799995422363281 0 0.4173228442668915;206 G6 2 0 0.4881889820098877;210.07000732421875 E5 1.9799995422363281 0 0.3937007784843445;212.0500030517578 E6 1.9799995422363281 0 0.4960629940032959;216.02000427246094 A4 1.9799995422363281 0 0.4330708682537079;214 C#6 2 0 0.4881889820098877;218.1300048828125 E5 1.9799995422363281 0 0.3937007784843445;220.1199951171875 D6 1.9799995422363281 0 0.4960629940032959;222.08999633789062 E6 1.9799995422363281 0 0.4881889820098877;224.0800018310547 A4 1.9799995422363281 0 0.4173228442668915;226.07000732421875 A5 1.9799995422363281 0 0.4881889820098877;228.0500030517578 D6 1.9799995422363281 0 0.4960629940032959;230.02000427246094 E6 1.9799995422363281 0 0.4881889820098877;232.02000427246094 F6 1.9799995422363281 0 0.5275590419769287;234.1300048828125 E6 1.9799995422363281 0 0.4881889820098877;236.1199951171875 D6 1.9799995422363281 0 0.4960629940032959;238.08999633789062 C6 1.9799995422363281 0 0.4881889820098877;244.0500030517578 A5 1.9799995422363281 0 0.4960629940032959;246.02000427246094 A#5 1.9799995422363281 0 0.4881889820098877;248 C6 2 0 0.5275590419769287;250.1300048828125 C5 1.9799995422363281 0 0.3937007784843445;252 F6 2 0 0.4960629940032959;254.08999633789062 C5 1.9799995422363281 0 0.3937007784843445;256.0799865722656 E6 1.9799995422363281 0 0.5118110179901123;258.07000732421875 D6 1.9799995422363281 0 0.4881889820098877;260.04998779296875 D6 1.9799995422363281 0 0.4960629940032959;262.0199890136719 C6 1.9799995422363281 0 0.4881889820098877;264.0199890136719 D6 1.9799995422363281 0 0.5275590419769287;266.1300048828125 C6 1.9799995422363281 0 0.4881889820098877;268 C6 2 0 0.4960629940032959;270.0899963378906 C5 1.9799995422363281 0 0.3937007784843445;272 C6 2 0 0.5118110179901123;274.07000732421875 C5 1.9799995422363281 0 0.3937007784843445;276 A5 1 0 0.4960629940032959;278 A#5 1 0 0.4881889820098877;280 C6 1 0 0.5275590419769287;282 C5 1.9799995422363281 0 0.3937007784843445;284 F6 1 0 0.4960629940032959;286.0899963378906 C5 1.9799995422363281 0 0.3937007784843445;288.0799865722656 G6 1 0 0.5118110179901123;290 F6 1 0 0.4881889820098877;292 E6 1 0 0.4960629940032959;294 D6 1 0 0.4881889820098877;296 D6 1 0 0.5275590419769287;298 E6 1 0 0.4881889820098877;300 F6 2 0 0.4960629940032959;302.0899963378906 C5 1.9799995422363281 0 0.3937007784843445;304 F6 2 0 0.5118110179901123;306.07000732421875 C5 1.9799995422363281 0 0.3937007784843445;308.04998779296875 G6 1.9799995422363281 0 0.4960629940032959;310.0199890136719 A6 1.9799995422363281 0 0.4881889820098877;312.0199890136719 A#6 1.9799995422363281 0 0.5275590419769287;314.1300048828125 A#6 1.9799995422363281 0 0.4881889820098877;316 A6 2 0 0.4960629940032959;318.0899963378906 F5 1.9799995422363281 0 0.3937007784843445;320 G6 2 0 0.5118110179901123;322.07000732421875 F5 1.9799995422363281 0 0.3937007784843445;324.04998779296875 F6 1.9799995422363281 0 0.4960629940032959;326.0199890136719 G6 1.9799995422363281 0 0.4881889820098877;328.0199890136719 A6 1.9799995422363281 0 0.5275590419769287;330.1300048828125 A6 1.9799995422363281 0 0.4881889820098877;332 G6 2 0 0.4960629940032959;334.0899963378906 C5 1.9799995422363281 0 0.3937007784843445;336 F6 2 0 0.5118110179901123;338.07000732421875 C5 1.9799995422363281 0 0.3937007784843445;340.04998779296875 D6 1.9799995422363281 0 0.4960629940032959;342.0199890136719 C6 1.9799995422363281 0 0.4881889820098877;344.0199890136719 D6 1.9799995422363281 0 0.5275590419769287;346.1300048828125 F6 1.9799995422363281 0 0.4881889820098877;348.1199951171875 F6 1.9799995422363281 0 0.4960629940032959;350 E6 2 0 0.4881889820098877;352.0799865722656 A4 1.9799995422363281 0 0.4173228442668915;354.07000732421875 E6 1.9799995422363281 0 0.4881889820098877;356.04998779296875 F#6 1.9799995422363281 0 0.4960629940032959;358 F#6 2 0 0.4881889820098877;360.0199890136719 A4 3.980010986328125 0 0.6456692814826965;364.1199951171875 F#6 1.9799995422363281 0 0.5039370059967041;366.0899963378906 D6 1.9799995422363281 0 0.4960629940032959;368.0799865722656 B5 1.9799995422363281 0 0.5196850299835205;370.07000732421875 D6 1.9799995422363281 0 0.4960629940032959;372.04998779296875 F#6 1.9799995422363281 0 0.5039370059967041;374.0199890136719 D6 1.9799995422363281 0 0.4960629940032959;376.0199890136719 A5 1.9799995422363281 0 0.5354330539703369;378.1300048828125 D6 1.9799995422363281 0 0.4960629940032959;380.1199951171875 F#6 1.9799995422363281 0 0.5039370059967041;382.0899963378906 D6 1.9799995422363281 0 0.4960629940032959;384.0799865722656 B5 1.9799995422363281 0 0.5196850299835205;386.07000732421875 D6 1.9799995422363281 0 0.4960629940032959;388.04998779296875 F#6 1.9799995422363281 0 0.5039370059967041;390.0199890136719 D6 1.9799995422363281 0 0.4960629940032959;392.0199890136719 A5 1.9799995422363281 0 0.5354330539703369;394.1300048828125 D6 1.9799995422363281 0 0.4960629940032959;396.1199951171875 F#6 1.9799995422363281 0 0.5039370059967041;398.0899963378906 D6 1.9799995422363281 0 0.4960629940032959;400.0799865722656 B5 1.9799995422363281 0 0.5196850299835205;402.07000732421875 D6 1.9799995422363281 0 0.4960629940032959;404.04998779296875 F#6 1.9799995422363281 0 0.5039370059967041;406.0199890136719 D6 1.9799995422363281 0 0.4960629940032959;408.0199890136719 A5 1.9799995422363281 0 0.5354330539703369;410.1300048828125 D6 1.9799995422363281 0 0.4960629940032959;412.1199951171875 F#6 1.9799995422363281 0 0.5039370059967041;160 G6 1.9799995422363281 0 0.5118110179901123', pins=[Pin(21)], looping=False)
}

arm_current_pos = arm_positions[0]
flag_current_pos = flag_positions[0]
lid_current_pos = lid_positions[0]

lid.duty_u16(lid_current_pos)
flag.duty_u16(flag_current_pos)
arm.duty_u16(arm_current_pos)


give_up_prog = ["l_8_2", "f_8_1", "f_10_2", "f_8_2", "p_0.3", "f_10_2", "f_8_2", "p_0.3", "f_10_2", "f_8_2", "p_0.3", "f_10_1", "l_10_1", "a_10_3", "p_1", "a_0_3", "f_0_3", "l_0_3", "s_stillAlive", "e_0"]

programs = {
    "straight_slow": ["l_8_2", "a_10_2", "a_0_2", "l_0_2", "s_rand"],
    "straight_medium": ["l_8_4", "a_10_4", "a_0_3", "l_0_4", "s_rand"],
    "straight_fast": ["l_9_5", "a_10_5", "a_0_5", "l_0_5", "s_rand"],
    "slowAndStrange": ["l_5_1", "p_1", "l_0_4", "p_1", "l_8_3", "a_8_0", "p_1", "a_10_4", "a_0_4", "p_1", "l_0_1", "s_rand"],
    "hesitating": ["l_5_2", "p_1", "l_0_1", "p_2", "l_8_2", "a_5_2", "p_1", "a_6_0", "p_1", "a_5_1", "p_1", "a_6_2", "p_0.5", "a_10_0", "p_2", "a_0_3", "l_0_5"],
    "reassured": ["l_8_4", "a_10_3", "a_0_3", "l_0_4", "s_failJingle", "p_0.5", "l_5_1", "l_6_2", "p_0.5", "l_5_1", "p_1", "l_6_2", "p_0.5", "l_0_4", "p_1", "l_8_4", "a_10_5", "p_1", "a_6_3", "p_0.5", "a_10_5", "p_3.5","l_6_4", "p_0.1", "l_8_4", "p_0.1", "l_6_4", "p_0.1", "l_8_4", "p_0.1", "l_6_4", "p_0.1", "l_9_5", "p_0.1", "a_0_5", "l_0_5" ],
    "fastAndAngry": ["l_8_4", "a_10_5", "p_1", "a_0_5", "p_0.25", "l_0_5", "l_8_4", "l_0_5", "l_8_4", "l_0_5", "l_8_4", "l_0_5", "s_rand"],
    "angryArm": ["l_8_5", "a_5_3", "p_0.25", "l_9_4", "a_8_5", "p_0.1", "a_0_5", "p_0.1", "s_beeps", "l_8_1", "a_5_4", "p_0.1", "a_8_5", "p_0.1", "a_0_4", "p_0.1", "a_10_5", "p_0.5", "a_5_3", "p_1", "a_10_5", "a_0_5", "p_0.5", "a_10_5", "p_1", "a_5_0", "a_10_5", "p_0.5", "a_0_5", "l_0_5", "s_mesto"]
}

programs_b = {
    
}

def playMelody( song ):
    song.restart()
    while song.tick():
        time.sleep(0.04)

def moveArm(to, speed):
    global arm, arm_current_pos
    if arm_current_pos > to:
        speed = -speed
    for i in range(arm_current_pos, to, speed):  
        arm.duty_u16(i)
        time.sleep(0.01)
    arm_current_pos = to
        
def moveLid(to, speed):
    global lid, lid_current_pos
    if lid_current_pos > to:
        speed = -speed
    for i in range(lid_current_pos, to, speed):  
        lid.duty_u16(i)
        time.sleep(0.01)
    lid_current_pos = to
    
def moveFlag(to, speed):
    global flag, flag_current_pos
    if flag_current_pos > to:
        speed = -speed
    for i in range(flag_current_pos, to, speed):  
        flag.duty_u16(i)
        time.sleep(0.01)
    flag_current_pos = to


count = 0
isRunning = True

print("running...")

programs_to_run = list(programs.keys())
num_of_programs = len(programs_to_run)

while isRunning:
    if switch.value():
        if not programs_to_run:
            programs_to_run = list(programs.keys())
        print("counter: ", count)
        if count > MAX_NORMAL_TRIES and random.randint(0, 2) == 1:
            progname = "giveUp"
            movement = give_up_prog
        else:
            progname = random.choice(programs_to_run)
            programs_to_run.remove(progname)
            movement = programs[progname]
        print(progname)
        for elem in movement:
            elem_splits = elem.split("_")
            arg = elem_splits[1]
            if elem_splits[0] == "a":
                pos = arm_positions[int(arg)]
                speed = speeds[int(elem_splits[2])]
                moveArm(pos, speed)
            elif elem_splits[0] == "l":
                pos = lid_positions[int(arg)]
                speed = speeds[int(elem_splits[2])]
                moveLid(pos, speed)
            elif elem_splits[0] == "f":
                pos = flag_positions[int(arg)]
                speed = speeds[int(elem_splits[2])]
                moveFlag(pos, speed)
            elif elem_splits[0] == "p":
                time.sleep(float(arg))
            elif elem_splits[0] == "s":
                songname = arg
                song = None
                if arg == 'rand':
                    if random.randint(0, 2) == 1:
                        songname, song = random.choice(list(shortSongs.items()))
                else:
                    allsongs = dict(shortSongs)
                    allsongs.update(longSongs)
                    song = allsongs[songname]
                if song is not None:
                    playMelody(song) 
            elif elem_splits[0] == "e":
                isRunning = False
                
        count = count + 1
